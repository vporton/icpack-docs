<!DOCTYPE html>
<html><head title="Doc"><meta charset="UTF-8"/><link href="../styles.css" rel="stylesheet"/></head><body><nav class="sidebar"><h3>Modules</h3><ul><li><li><a href="../bootstrapper_backend/BootstrapperData.html">bootstrapper_backend/BootstrapperData</a></li></li><li><li><a href="../bootstrapper_backend/bookmarks.html">bootstrapper_backend/bookmarks</a></li></li><li><li><a href="../bootstrapper_backend/bootstrapper.html">bootstrapper_backend/bootstrapper</a></li></li><li><li><a href="../common.html">common</a></li></li><li><li><a href="../copy_assets.html">copy_assets</a></li></li><li><li><a href="../install.html">install</a></li></li><li><li><a href="../lib/Account.html">lib/Account</a></li></li><li><li><a href="../package_manager_backend/battery.html">package_manager_backend/battery</a></li></li><li><li><a href="../package_manager_backend/main_indirect.html">package_manager_backend/main_indirect</a></li></li><li><li><a href="../package_manager_backend/package_manager.html">package_manager_backend/package_manager</a></li></li><li><li><a href="../package_manager_backend/simple_indirect.html">package_manager_backend/simple_indirect</a></li></li><li><li><a href="../repository_backend/Repository.html">repository_backend/Repository</a></li></li></ul><h3>Declarations</h3><ul><li><li><a href="#type.PackageManager">PackageManager</a></li></li></ul></nav><div class="documentation"><h1>package_manager_backend/package_manager</h1><p>TODO@P3: Methods to query for all installed packages.</p>
<div class="declaration"><h4 class="class-declaration" id="type.PackageManager"><span class="keyword">actor </span><span class="keyword">class </span><span class="classname">PackageManager</span>()</h4><div class="declaration"><h4 class="type-declaration" id="PackageManager.type.HalfInstalledPackageInfo"><span class="keyword">type </span><span class="type">HalfInstalledPackageInfo</span> = { package : <a href="../common.html#type.PackageInfo"><span class="type">Common.PackageInfo</span></a>; packageRepoCanister : <span class="type">Principal</span>; modulesInstalledByDefault : <span class="type">HashMap.HashMap</span>&lt;<span class="type">Text</span>, <span class="type">Principal</span>&gt;; minInstallationId : <span class="type">Nat</span>; afterInstallCallback : ?{ canister : <span class="type">Principal</span>; name : <span class="type">Text</span>; data : <span class="type">Blob</span> }; bootstrapping : <span class="type">Bool</span>; <span class="keyword">var </span>remainingModules : <span class="type">Nat</span>; arg : <span class="type">Blob</span>; initArg : ?<span class="type">Blob</span> }</h4><p></p></div><div class="declaration"><h4 class="type-declaration" id="PackageManager.type.SharedHalfInstalledPackageInfo"><span class="keyword">type </span><span class="type">SharedHalfInstalledPackageInfo</span> = { package : <a href="../common.html#type.SharedPackageInfo"><span class="type">Common.SharedPackageInfo</span></a>; packageRepoCanister : <span class="type">Principal</span>; modulesInstalledByDefault : [(<span class="type">Text</span>, <span class="type">Principal</span>)]; minInstallationId : <span class="type">Nat</span>; afterInstallCallback : ?{ canister : <span class="type">Principal</span>; name : <span class="type">Text</span>; data : <span class="type">Blob</span> }; bootstrapping : <span class="type">Bool</span>; remainingModules : <span class="type">Nat</span>; arg : <span class="type">Blob</span>; initArg : ?<span class="type">Blob</span> }</h4><p></p></div><div class="declaration"><h4 class="type-declaration" id="PackageManager.type.HalfUninstalledPackageInfo"><span class="keyword">type </span><span class="type">HalfUninstalledPackageInfo</span> = { installationId : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a>; package : <a href="../common.html#type.PackageInfo"><span class="type">Common.PackageInfo</span></a>; <span class="keyword">var </span>remainingModules : <span class="type">Nat</span> }</h4><p></p></div><div class="declaration"><h4 class="type-declaration" id="PackageManager.type.SharedHalfUninstalledPackageInfo"><span class="keyword">type </span><span class="type">SharedHalfUninstalledPackageInfo</span> = { installationId : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a>; package : <a href="../common.html#type.SharedPackageInfo"><span class="type">Common.SharedPackageInfo</span></a>; remainingModules : <span class="type">Nat</span> }</h4><p></p></div><div class="declaration"><h4 class="type-declaration" id="PackageManager.type.HalfUpgradedPackageInfo"><span class="keyword">type </span><span class="type">HalfUpgradedPackageInfo</span> = { installationId : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a>; package : <a href="../common.html#type.PackageInfo"><span class="type">Common.PackageInfo</span></a>; newRepo : <span class="type">Principal</span>; modulesInstalledByDefault : <span class="type">HashMap.HashMap</span>&lt;<span class="type">Text</span>, <span class="type">Principal</span>&gt;; modulesToDelete : [(<span class="type">Text</span>, <span class="type">Principal</span>)]; <span class="keyword">var </span>remainingModules : <span class="type">Nat</span>; arg : <span class="type">Blob</span>; initArg : ?<span class="type">Blob</span> }</h4><p></p></div><div class="declaration"><h4 class="type-declaration" id="PackageManager.type.SharedHalfUpgradedPackageInfo"><span class="keyword">type </span><span class="type">SharedHalfUpgradedPackageInfo</span> = { installationId : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a>; package : <a href="../common.html#type.SharedPackageInfo"><span class="type">Common.SharedPackageInfo</span></a>; newRepo : <span class="type">Principal</span>; modulesInstalledByDefault : [(<span class="type">Text</span>, <span class="type">Principal</span>)]; modulesToDelete : [(<span class="type">Text</span>, <span class="type">Principal</span>)]; remainingModules : <span class="type">Nat</span>; arg : <span class="type">Blob</span>; initArg : ?<span class="type">Blob</span> }</h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.init"><code><span class="keyword">public func </span><span class="fnname">init</span>() : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.setOwners"><code><span class="keyword">public func </span><span class="fnname">setOwners</span>(<span class="parameter">newOwners</span> : [<span class="type">Principal</span>]) : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.addOwner"><code><span class="keyword">public func </span><span class="fnname">addOwner</span>(<span class="parameter">newOwner</span> : <span class="type">Principal</span>) : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.removeOwner"><code><span class="keyword">public func </span><span class="fnname">removeOwner</span>(<span class="parameter">oldOwner</span> : <span class="type">Principal</span>) : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.getOwners"><code><span class="keyword">public func </span><span class="fnname">getOwners</span>() : <span class="keyword">async </span>[<span class="type">Principal</span>]</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.isAllInitialized"><code><span class="keyword">public func </span><span class="fnname">isAllInitialized</span>() : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.setMainIndirect"><code><span class="keyword">public func </span><span class="fnname">setMainIndirect</span>(<span class="parameter">main_indirect_v</span> : <a href="main_indirect.html#type.MainIndirect"><span class="type">MainIndirect.MainIndirect</span></a>) : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.installPackages"><code><span class="keyword">public func </span><span class="fnname">installPackages</span>() : <span class="keyword">async </span>{ minInstallationId : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a> }</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.uninstallPackages"><code><span class="keyword">public func </span><span class="fnname">uninstallPackages</span>() : <span class="keyword">async </span>{ minUninstallationId : <a href="../common.html#type.UninstallationId"><span class="type">Common.UninstallationId</span></a> }</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.upgradePackages"><code><span class="keyword">public func </span><span class="fnname">upgradePackages</span>() : <span class="keyword">async </span>{ minUpgradeId : <a href="../common.html#type.UpgradeId"><span class="type">Common.UpgradeId</span></a> }</code></h4><p><p>We first add new and upgrade existing modules (including executing hooks)
and only then delete modules to be deleted. That's because deleted modules may contain
important data that needs to be imported. Also having deleting modules at the end
does not prevent the package to start fully function before this.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.upgradeStart"><code><span class="keyword">public func </span><span class="fnname">upgradeStart</span>() : <span class="keyword">async </span>()</code></h4><p><p>Internal.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.onUpgradeOrInstallModule"><code><span class="keyword">public func </span><span class="fnname">onUpgradeOrInstallModule</span>() : <span class="keyword">async </span>()</code></h4><p><p>Internal</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.onDeleteCanister"><code><span class="keyword">public func </span><span class="fnname">onDeleteCanister</span>() : <span class="keyword">async </span>()</code></h4><p><p>Internal</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.facilitateBootstrap"><code><span class="keyword">public func </span><span class="fnname">facilitateBootstrap</span>() : <span class="keyword">async </span>{ minInstallationId : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a> }</code></h4><p><p>Internal used for bootstrapping.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.installStart"><code><span class="keyword">public func </span><span class="fnname">installStart</span>()</code></h4><p><p>Internal.</p>
<p>Initialize installation process object.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.onInstallCode"><code><span class="keyword">public func </span><span class="fnname">onInstallCode</span>() : <span class="keyword">async </span>()</code></h4><p><p>Internal</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.getAllCanisters"><code><span class="keyword">public func </span><span class="fnname">getAllCanisters</span>() : <span class="keyword">async </span>[({ packageName : <span class="type">Text</span>; guid : <span class="type">Blob</span> }, [(<span class="type">Text</span>, <span class="type">Principal</span>)])]</code></h4><p><p>Returns all (default installed and additional) modules canisters.
Internal.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.getInstalledPackage"><code><span class="keyword">public func </span><span class="fnname">getInstalledPackage</span>(<span class="parameter">id</span> : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a>) : <span class="keyword">async </span><a href="../common.html#type.SharedInstalledPackageInfo"><span class="type">Common.SharedInstalledPackageInfo</span></a></code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.getModulePrincipal"><code><span class="keyword">public func </span><span class="fnname">getModulePrincipal</span>(<span class="parameter">installationId</span> : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a>, <span class="parameter">moduleName</span> : <span class="type">Text</span>) : <span class="keyword">async </span><span class="type">Principal</span></code></h4><p><p>Note that it applies only to default installed modules and fails for additional modules.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.getInstalledPackagesInfoByName"><code><span class="keyword">public func </span><span class="fnname">getInstalledPackagesInfoByName</span>(<span class="parameter">name</span> : <span class="type">Text</span>, <span class="parameter">guid</span> : <span class="type">Blob</span>) : <span class="keyword">async </span>{ all : [<a href="../common.html#type.SharedInstalledPackageInfo"><span class="type">Common.SharedInstalledPackageInfo</span></a>]; default : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a> }</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.getAllInstalledPackages"><code><span class="keyword">public func </span><span class="fnname">getAllInstalledPackages</span>() : <span class="keyword">async </span>[(<a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a>, <a href="../common.html#type.SharedInstalledPackageInfo"><span class="type">Common.SharedInstalledPackageInfo</span></a>)]</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.getHalfInstalledPackages"><code><span class="keyword">public func </span><span class="fnname">getHalfInstalledPackages</span>() : <span class="keyword">async </span>[{ installationId : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a>; package : <a href="../common.html#type.SharedPackageInfo"><span class="type">Common.SharedPackageInfo</span></a> }]</code></h4><p><p>Internal.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.getHalfUninstalledPackages"><code><span class="keyword">public func </span><span class="fnname">getHalfUninstalledPackages</span>() : <span class="keyword">async </span>[{ uninstallationId : <a href="../common.html#type.UninstallationId"><span class="type">Common.UninstallationId</span></a>; package : <a href="../common.html#type.SharedPackageInfo"><span class="type">Common.SharedPackageInfo</span></a> }]</code></h4><p><p>Internal.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.getHalfUpgradedPackages"><code><span class="keyword">public func </span><span class="fnname">getHalfUpgradedPackages</span>() : <span class="keyword">async </span>[{ upgradeId : <a href="../common.html#type.UpgradeId"><span class="type">Common.UpgradeId</span></a>; package : <a href="../common.html#type.SharedPackageInfo"><span class="type">Common.SharedPackageInfo</span></a> }]</code></h4><p><p>Internal.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.getHalfInstalledPackageModulesById"><code><span class="keyword">public func </span><span class="fnname">getHalfInstalledPackageModulesById</span>(<span class="parameter">installationId</span> : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a>) : <span class="keyword">async </span>[(<span class="type">Text</span>, <span class="type">Principal</span>)]</code></h4><p><p>TODO@P3: very unstable API.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.setPinned"><code><span class="keyword">public func </span><span class="fnname">setPinned</span>(<span class="parameter">installationId</span> : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a>, <span class="parameter">pinned</span> : <span class="type">Bool</span>) : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.removeStalled"><code><span class="keyword">public func </span><span class="fnname">removeStalled</span>() : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.userAccountText"><code><span class="keyword">public func </span><span class="fnname">userAccountText</span>() : <span class="keyword">async </span><span class="type">Text</span></code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.userBalance"><code><span class="keyword">public func </span><span class="fnname">userBalance</span>() : <span class="keyword">async </span><span class="type">Nat</span></code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.getNewCanisterCycles"><code><span class="keyword">public func </span><span class="fnname">getNewCanisterCycles</span>() : <span class="keyword">async </span><span class="type">Nat</span></code></h4><p><p>The total cycles amount, including canister creation fee.</p>
</p></div><div class="declaration"><h4 class="function" id="PackageManager.addRepository"><code><span class="keyword">public func </span><span class="fnname">addRepository</span>(<span class="parameter">canister</span> : <span class="type">Principal</span>, <span class="parameter">name</span> : <span class="type">Text</span>) : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.removeRepository"><code><span class="keyword">public func </span><span class="fnname">removeRepository</span>(<span class="parameter">canister</span> : <span class="type">Principal</span>) : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.getRepositories"><code><span class="keyword">public func </span><span class="fnname">getRepositories</span>() : <span class="keyword">async </span>[{ canister : <span class="type">Principal</span>; name : <span class="type">Text</span> }]</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.setDefaultInstalledPackage"><code><span class="keyword">public func </span><span class="fnname">setDefaultInstalledPackage</span>(<br/>  <span class="parameter">name</span> : <a href="../common.html#type.PackageName"><span class="type">Common.PackageName</span></a>, <br/>  <span class="parameter">guid</span> : <span class="type">Blob</span>, <br/>  <span class="parameter">installationId</span> : <a href="../common.html#type.InstallationId"><span class="type">Common.InstallationId</span></a><br/>) : <span class="keyword">async </span>()</code></h4><p></p></div><div class="declaration"><h4 class="function" id="PackageManager.withdrawCycles"><code><span class="keyword">public func </span><span class="fnname">withdrawCycles</span>(<span class="parameter">amount</span> : <span class="type">Nat</span>, <span class="parameter">payee</span> : <span class="type">Principal</span>) : <span class="keyword">async </span>()</code></h4><p></p></div><p></p></div></div></body></html>